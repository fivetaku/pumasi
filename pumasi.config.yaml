pumasi:
  defaults:
    command: "codex exec --dangerously-bypass-approvals-and-sandbox --skip-git-repo-check --ephemeral"
    emoji: "ğŸ¤–"

  settings:
    timeout: 120
    max_retries: 1

  tasks:
    # ============================================
    # Round 1: 3ê°€ì§€ instruction ìŠ¤íƒ€ì¼ ë¹„êµ
    # ============================================

    # Style A: ìµœì†Œ ì§€ì‹œ (Minimal)
    - name: string-utils
      round: 1
      instruction: |
        Create src/string-utils.ts with these functions:
        - formatDate: takes Date and FormatOptions, returns formatted string
        - slugify: takes string, returns URL-safe slug
        - truncate: takes string and maxLength number, returns truncated string with "..."
        Use the types from src/types.ts (FormatOptions).
        Do not create any other files.
      cwd: /tmp/pumasi-test-workspace
      gates:
        - name: "íŒŒì¼ ì¡´ì¬"
          command: "test -f /tmp/pumasi-test-workspace/src/string-utils.ts"
        - name: "formatDate í•¨ìˆ˜"
          command: "grep -q 'formatDate' /tmp/pumasi-test-workspace/src/string-utils.ts"
        - name: "slugify í•¨ìˆ˜"
          command: "grep -q 'slugify' /tmp/pumasi-test-workspace/src/string-utils.ts"
        - name: "truncate í•¨ìˆ˜"
          command: "grep -q 'truncate' /tmp/pumasi-test-workspace/src/string-utils.ts"
        - name: "types import"
          command: "grep -q 'FormatOptions' /tmp/pumasi-test-workspace/src/string-utils.ts"

    # Style B: êµ¬ì¡°í™” í…œí”Œë¦¿ (Structured)
    - name: validation-utils
      round: 1
      instruction: |
        # ì‘ì—… ì§€ì‹œì„œ: validation-utils

        ## ìƒì„± íŒŒì¼
        - src/validation-utils.ts (ì´ íŒŒì¼ë§Œ ìƒì„±, ë‹¤ë¥¸ íŒŒì¼ ê¸ˆì§€)

        ## ì°¸ì¡° íŒŒì¼
        - src/types.ts (ValidationResult íƒ€ì… ì‚¬ìš©)

        ## êµ¬í˜„ ì‹œê·¸ë‹ˆì²˜
        ```typescript
        import { ValidationResult } from './types';

        export function validateEmail(email: string): ValidationResult
        export function validatePhone(phone: string): ValidationResult
        export function validateUrl(url: string): ValidationResult
        ```

        ## êµ¬í˜„ ì„¸ë¶€ì‚¬í•­
        - validateEmail: RFC 5322 ê¸°ë³¸ íŒ¨í„´ (/^[^\s@]+@[^\s@]+\.[^\s@]+$/)
        - validatePhone: í•œêµ­ ì „í™”ë²ˆí˜¸ íŒ¨í„´ (010-XXXX-XXXX ë˜ëŠ” 01X-XXX-XXXX)
        - validateUrl: URL ìƒì„±ì ê¸°ë°˜ ê²€ì¦ (new URL())
        - ì‹¤íŒ¨ ì‹œ error í•„ë“œì— êµ¬ì²´ì  ë©”ì‹œì§€ í¬í•¨

        ## ê¸ˆì§€ì‚¬í•­
        - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¸ˆì§€ (ìˆœìˆ˜ TypeScriptë§Œ)
        - ë‹¤ë¥¸ íŒŒì¼ ìƒì„± ê¸ˆì§€
      cwd: /tmp/pumasi-test-workspace
      gates:
        - name: "íŒŒì¼ ì¡´ì¬"
          command: "test -f /tmp/pumasi-test-workspace/src/validation-utils.ts"
        - name: "validateEmail export"
          command: "grep -q 'export function validateEmail' /tmp/pumasi-test-workspace/src/validation-utils.ts"
        - name: "validatePhone export"
          command: "grep -q 'export function validatePhone' /tmp/pumasi-test-workspace/src/validation-utils.ts"
        - name: "validateUrl export"
          command: "grep -q 'export function validateUrl' /tmp/pumasi-test-workspace/src/validation-utils.ts"
        - name: "ValidationResult import"
          command: "grep -q 'ValidationResult' /tmp/pumasi-test-workspace/src/validation-utils.ts"
        - name: "ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¯¸ì‚¬ìš©"
          command: "! grep -q 'require(' /tmp/pumasi-test-workspace/src/validation-utils.ts"

    # Style C: ëŒ€í™”ì²´ (Conversational)
    - name: math-utils
      round: 1
      instruction: |
        ìˆ˜í•™ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ì„ ë§Œë“¤ì–´ì¤˜. íŒŒì¼ì€ src/math-utils.tsì— ë§Œë“¤ë©´ ë¼.
        src/types.tsì— MathRangeë¼ëŠ” íƒ€ì…ì´ ìˆëŠ”ë°, minê³¼ maxê°€ ìˆì–´. ê·¸ê±¸ í™œìš©í•´ì¤˜.

        í•„ìš”í•œ í•¨ìˆ˜ëŠ” ì„¸ ê°œì•¼:
        1. clamp - ìˆ«ìë¥¼ min/max ë²”ìœ„ ì•ˆìœ¼ë¡œ ì œí•œí•˜ëŠ” ê±°. MathRangeë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ë©´ ì¢‹ê² ì–´.
        2. lerp - ì„ í˜• ë³´ê°„. ë‘ ìˆ«ì ì‚¬ì´ë¥¼ t(0~1)ë¡œ ë³´ê°„í•˜ëŠ” ê±°ì•¼.
        3. randomBetween - MathRange ë°›ì•„ì„œ ê·¸ ë²”ìœ„ ì•ˆì—ì„œ ëœë¤ ìˆ«ì ë°˜í™˜.

        ë‹¤ë¥¸ íŒŒì¼ì€ ë§Œë“¤ì§€ ë§ê³ , ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì“°ì§€ ë§ˆ.
      cwd: /tmp/pumasi-test-workspace
      gates:
        - name: "íŒŒì¼ ì¡´ì¬"
          command: "test -f /tmp/pumasi-test-workspace/src/math-utils.ts"
        - name: "clamp í•¨ìˆ˜"
          command: "grep -q 'clamp' /tmp/pumasi-test-workspace/src/math-utils.ts"
        - name: "lerp í•¨ìˆ˜"
          command: "grep -q 'lerp' /tmp/pumasi-test-workspace/src/math-utils.ts"
        - name: "randomBetween í•¨ìˆ˜"
          command: "grep -q 'randomBetween' /tmp/pumasi-test-workspace/src/math-utils.ts"
        - name: "MathRange import"
          command: "grep -q 'MathRange' /tmp/pumasi-test-workspace/src/math-utils.ts"

    # ============================================
    # Round 2: Round 1 ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ëŠ” í†µí•© ëª¨ë“ˆ
    # ============================================
    - name: index-barrel
      round: 2
      instruction: |
        # ì‘ì—… ì§€ì‹œì„œ: index-barrel

        ## ìƒì„± íŒŒì¼
        - src/index.ts (ì´ íŒŒì¼ë§Œ ìƒì„±)

        ## êµ¬í˜„ ë‚´ìš©
        Round 1ì—ì„œ ìƒì„±ëœ ëª¨ë“ˆë“¤ì„ re-exportí•˜ëŠ” barrel íŒŒì¼ì„ ë§Œë“œì„¸ìš”:

        ```typescript
        export { formatDate, slugify, truncate } from './string-utils';
        export { validateEmail, validatePhone, validateUrl } from './validation-utils';
        export { clamp, lerp, randomBetween } from './math-utils';
        export type { FormatOptions, ValidationResult, MathRange } from './types';
        ```

        ìœ„ ë‚´ìš©ì„ ì •í™•íˆ ê·¸ëŒ€ë¡œ ì‘ì„±í•˜ì„¸ìš”.

        ## ê¸ˆì§€ì‚¬í•­
        - ë‹¤ë¥¸ íŒŒì¼ ìƒì„± ê¸ˆì§€
        - ìœ„ ì½”ë“œ ì™¸ ì¶”ê°€ ì½”ë“œ ê¸ˆì§€
      cwd: /tmp/pumasi-test-workspace
      gates:
        - name: "íŒŒì¼ ì¡´ì¬"
          command: "test -f /tmp/pumasi-test-workspace/src/index.ts"
        - name: "string-utils re-export"
          command: "grep -q 'string-utils' /tmp/pumasi-test-workspace/src/index.ts"
        - name: "validation-utils re-export"
          command: "grep -q 'validation-utils' /tmp/pumasi-test-workspace/src/index.ts"
        - name: "math-utils re-export"
          command: "grep -q 'math-utils' /tmp/pumasi-test-workspace/src/index.ts"
